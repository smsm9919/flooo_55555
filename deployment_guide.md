# Flohmarkt Production Deployment Guide

## Quick Setup on Render

### 1. Create Web Service
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" → "Web Service"
3. Connect your GitHub repository
4. Use these settings:
   - **Name**: `flowmarket`
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements_production.txt`
   - **Start Command**: `gunicorn -c gunicorn.conf.py app:app`
   - **Health Check Path**: `/healthz`

### 2. Create PostgreSQL Database
1. Click "New +" → "PostgreSQL"
2. Database name: `flowmarket-db`
3. User: `flowmarket_user`
4. Copy the DATABASE_URL from database settings

### 3. Environment Variables
Add these in your web service settings:
```
SECRET_KEY=<auto-generated by Render>
DATABASE_URL=<from PostgreSQL service>
ADMIN_EMAIL=admin@flowmarket.com
ADMIN_PASSWORD=admin123
MAX_CONTENT_LENGTH=16777216
```

### 4. Custom Domain Setup

#### DNS Configuration for flowmarket.com:
**Root Domain (flowmarket.com):**
```
Type: CNAME (or ALIAS if supported)
Name: @
Value: flowmarket.onrender.com
```

**WWW Subdomain:**
```
Type: CNAME
Name: www
Value: flowmarket.onrender.com
```

#### Alternative with Cloudflare (Recommended):
If your DNS provider doesn't support CNAME for apex domain:
1. Transfer DNS management to Cloudflare
2. Add these DNS records in Cloudflare:
   ```
   Type: CNAME
   Name: flowmarket.com
   Value: flowmarket.onrender.com
   Proxy: ON (orange cloud)
   
   Type: CNAME
   Name: www
   Value: flowmarket.onrender.com
   Proxy: ON (orange cloud)
   ```

### 5. SSL & Domain Settings in Render
1. Go to your web service settings
2. Click "Custom Domains"
3. Add domains:
   - `flowmarket.com`
   - `www.flowmarket.com`
4. SSL certificates will be auto-generated
5. Enable redirect from www to non-www in service settings

## Local Development

### Prerequisites
- Python 3.11+
- PostgreSQL (optional, SQLite works locally)

### Setup
```bash
# Clone repository
git clone <your-repo-url>
cd flohmarkt

# Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements_production.txt

# Set environment variables
export SECRET_KEY="your-secret-key"
export DATABASE_URL="sqlite:///database.db"  # or PostgreSQL URL
export ADMIN_EMAIL="admin@flowmarket.com"
export ADMIN_PASSWORD="admin123"

# Run application
python app.py
```

### Environment Variables for Local Development
Create a `.env.local` file:
```
SECRET_KEY=flohmarkt_local_secret_key_2025
DATABASE_URL=sqlite:///database.db
ADMIN_EMAIL=admin@flowmarket.com
ADMIN_PASSWORD=admin123
MAX_CONTENT_LENGTH=16777216
```

## Database Management

### Backup Database (Render PostgreSQL)
```bash
# Get database URL from Render dashboard
export DATABASE_URL="postgresql://username:password@host:port/database"

# Create backup
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d_%H%M%S).sql
```

### Restore Database
```bash
# Restore from backup
psql $DATABASE_URL < backup_file.sql
```

### Local Database Reset
```bash
# Delete local database
rm database.db

# Restart application (it will recreate tables automatically)
python app.py
```

## Production URLs

- **Main Site**: https://flowmarket.com
- **Admin Panel**: https://flowmarket.com/admin
- **Health Check**: https://flowmarket.com/healthz

## Admin Credentials
- **Email**: admin@flowmarket.com
- **Password**: admin123

## Monitoring & Logs

### View Logs on Render
1. Go to your service dashboard
2. Click "Logs" tab
3. Monitor application logs in real-time

### Health Check
The application includes a health check endpoint at `/healthz` that returns:
```json
{
  "status": "healthy",
  "timestamp": "2025-01-27T18:23:00Z",
  "database": "connected"
}
```

## SSL Certificate
- Automatic SSL certificates via Let's Encrypt
- HTTPS redirect enabled
- HSTS headers configured
- Secure cookies in production

## Performance Optimization
- Gunicorn with 2 workers and gthread worker class
- Connection pooling for PostgreSQL
- Static file compression
- CDN-ready headers

## Troubleshooting

### Common Issues
1. **Database Connection Error**: Check DATABASE_URL environment variable
2. **SSL Certificate Pending**: Wait 10-15 minutes after domain setup
3. **Admin Not Created**: Check logs for initialization errors
4. **Upload Errors**: Verify MAX_CONTENT_LENGTH setting

### Support
- Check Render service logs for detailed error messages
- Verify all environment variables are set correctly
- Ensure PostgreSQL database is running and accessible