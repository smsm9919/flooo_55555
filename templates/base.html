<!DOCTYPE html>
<html lang="{{ get_current_language() }}" dir="{{ 'rtl' if get_current_language() == 'ar' else 'ltr' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Basic SEO Meta Tags -->
    <title>{{ _('site_title') }}</title>
    <meta name="description" content="فلو ماركت هو السوق الأول في مصر لبيع وشراء المنتجات المستعملة بأمان وبأسعار منافسة. اكتشف أفضل الصفقات على السيارات والهواتف والإلكترونيات وأكثر.">
    <meta name="keywords" content="فلو ماركت, مصر, منتجات مستعملة, بيع وشراء, سيارات مستعملة, هواتف مستعملة, إلكترونيات, أثاث مستعمل">
    <meta name="author" content="فلو ماركت">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{{ request.url }}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="فلو ماركت | السوق الأول في مصر لبيع وشراء المنتجات المستعملة">
    <meta property="og:description" content="فلو ماركت هو السوق الأول في مصر لبيع وشراء المنتجات المستعملة بأمان وبأسعار منافسة. اكتشف أفضل الصفقات على السيارات والهواتف والإلكترونيات وأكثر.">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="فلو ماركت">
    <meta property="og:image" content="{{ url_for('static', filename='images/og-image.jpg', _external=True) }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="ar_EG">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="فلو ماركت | السوق الأول في مصر لبيع وشراء المنتجات المستعملة">
    <meta name="twitter:description" content="فلو ماركت هو السوق الأول في مصر لبيع وشراء المنتجات المستعملة بأمان وبأسعار منافسة.">
    <meta name="twitter:image" content="{{ url_for('static', filename='images/og-image.jpg', _external=True) }}">
    <meta name="twitter:creator" content="@flowmarket">
    <meta name="twitter:site" content="@flowmarket">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "فلو ماركت",
        "alternateName": "Flohmarkt Egypt",
        "url": "{{ url_for('index', _external=True) }}",
        "description": "فلو ماركت هو السوق الأول في مصر لبيع وشراء المنتجات المستعملة بأمان وبأسعار منافسة",
        "inLanguage": "ar-EG",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "{{ url_for('products', _external=True) }}?search={search_term_string}",
            "query-input": "required name=search_term_string"
        },
        "publisher": {
            "@type": "Organization",
            "name": "فلو ماركت",
            "url": "{{ url_for('index', _external=True) }}",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ url_for('static', filename='images/logo.png', _external=True) }}"
            }
        }
    }
    </script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
</head>
<body>
<header class="header">
    <div class="container header-inner">
        <a class="logo" href="{{ url_for('index') }}">{{ 'فلو ماركت' if get_current_language() == 'ar' else 'Flohmarkt' }}</a>
        <nav class="nav">
            <a href="{{ url_for('index') }}">{{ _('navigation.home') }}</a>
            <a href="{{ url_for('products') }}">{{ _('navigation.products') }}</a>
            <a href="{{ url_for('products') }}?category={{ 'سيارات مستعملة' if get_current_language() == 'ar' else 'Used Cars' }}">{{ _('navigation.cars') }}</a>
            <a href="{{ url_for('jobs') }}">{{ _('navigation.jobs') }}</a>
            {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <a href="{{ url_for('admin_panel') }}" class="badge-admin">{{ _('navigation.admin') }}</a>
            {% endif %}
        </nav>
        <div class="auth">
            <!-- Language Switcher -->
            <div class="language-switcher" style="display: inline-block; margin-left: 15px;">
                {% if get_current_language() == 'ar' %}
                    <a href="{{ url_for('set_language', language='en') }}" class="btn btn-outline-sm" title="English" style="padding: 5px 10px; font-size: 12px;">EN</a>
                {% else %}
                    <a href="{{ url_for('set_language', language='ar') }}" class="btn btn-outline-sm" title="العربية" style="padding: 5px 10px; font-size: 12px;">عربي</a>
                {% endif %}
            </div>
            
            {% if current_user.is_authenticated %}
                <span class="hello">{{ 'مرحبًا، ' if get_current_language() == 'ar' else 'Hello, ' }}{{ current_user.fullname }}</span>
                <a href="{{ url_for('my_products') }}" class="btn btn-secondary"><i class="fa fa-box"></i> {{ _('navigation.my_products') }}</a>
                <a href="{{ url_for('seller_inbox') }}" class="btn btn-info position-relative inbox-btn" title="صندوق الوارد - الرسائل الجديدة">
                    <i class="fa fa-inbox"></i> الرسائل
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="messagesBadge" style="display: none;">
                        <span id="messageCount">0</span>
                    </span>
                </a>
                <a href="{{ url_for('add_product') }}" class="btn btn-primary btn-add-product"><i class="fa fa-plus"></i> {{ _('common.add') }} {{ _('admin.product_name').lower() if get_current_language() == 'ar' else 'Product' }}</a>
                {% if current_user.role == 'admin' %}
                <a href="{{ url_for('admin_panel') }}" class="btn btn-admin"><i class="fas fa-cog"></i> {{ _('navigation.admin') }}</a>
                {% endif %}
                <a href="{{ url_for('logout') }}" class="btn btn-outline">{{ _('navigation.logout') }}</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="btn btn-outline">{{ _('navigation.login') }}</a>
                <a href="{{ url_for('register') }}" class="btn btn-primary">{{ _('navigation.register') }}</a>
                <a href="#" onclick="alert('{{ 'يرجى تسجيل الدخول أولاً لإضافة منتج' if get_current_language() == 'ar' else 'Please login first to add a product' }}'); return false;" class="btn btn-primary btn-disabled"><i class="fa fa-plus"></i> {{ _('common.add') }} {{ 'منتج' if get_current_language() == 'ar' else 'Product' }}</a>
            {% endif %}
        </div>
    </div>
</header>

<main class="container">
    {% block content %}{% endblock %}
</main>

<footer class="footer">
    <div class="container">
        <p>{{ _('footer.copyright') }}</p>
        <p>
            <a href="#">{{ _('footer.privacy') }}</a> ·
            <a href="#">{{ _('footer.terms') }}</a>
        </p>
    </div>
</footer>

<!-- Bootstrap JS for modals -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Message notification checker -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if current_user.is_authenticated %}
    // Check for unread messages periodically
    function checkUnreadMessages() {
        fetch('/api/unread_messages_count')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.count > 0) {
                    const messagesBadge = document.getElementById('messagesBadge');
                    const messageCount = document.getElementById('messageCount');
                    if (messagesBadge && messageCount) {
                        messageCount.textContent = data.count;
                        messagesBadge.style.display = 'block';
                        
                        // Add pulse animation
                        messagesBadge.classList.add('pulse-animation');
                    }
                } else {
                    const messagesBadge = document.getElementById('messagesBadge');
                    if (messagesBadge) {
                        messagesBadge.style.display = 'none';
                    }
                }
            })
            .catch(error => {
                console.log('Error checking messages:', error);
            });
    }
    
    // Check immediately and then every 30 seconds
    checkUnreadMessages();
    setInterval(checkUnreadMessages, 30000);
    {% endif %}
});
</script>

<style>
.inbox-btn:hover {
    transform: scale(1.05);
    transition: all 0.3s ease;
}

.pulse-animation {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(1.1);
        opacity: 0.8;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

.position-relative {
    position: relative !important;
}

.position-absolute {
    position: absolute !important;
}

.top-0 {
    top: 0 !important;
}

.start-100 {
    left: 100% !important;
}

.translate-middle {
    transform: translate(-50%, -50%) !important;
}

.badge {
    padding: 0.25em 0.4em;
    font-size: 0.75em;
    font-weight: 700;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 0.375rem;
}

.rounded-pill {
    border-radius: 50rem !important;
}

.bg-danger {
    background-color: #dc3545 !important;
    color: white;
}
</style>

</body>
</html>
